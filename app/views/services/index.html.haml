- if @services.length < 1
  .twelve.panel
    %b There are no services

- else
  %dl.tabs
    - is_first = true
    - if current_user.is_admin or current_user.is_red_team
      %dd.active{id: 'overview'}
        = link_to "Overview", "#overview"
        - is_first = false
    - @services.each do |team, service_list|
      - team = Team.new(name: 'None', id: 0) if team.nil?
      %dd{class: (is_first ? 'active':''), id: team.id}
        = link_to "Team #{team.name}", "#team#{team.id}"
      - is_first = false

  %ul.tabs-content#team-tabs
    - is_first = true
    - if current_user.is_admin or current_user.is_red_team
      %li#overviewTab.active
        %table.service-overview
          %thead
            %tr
              %th.two Service
              - @teams.each do |team|
                %th.two= "Team #{team.name}"
          %tbody
            - @overview.each do |service_name, overview_data|
              %tr
                %td
                  %b= service_name
                - @teams.each do |team|
                  %td
                    - if overview_data.key? team.id
                      %a{href: service_path(overview_data[team.id][:service_id])}
                        %img{src:overview_data[team.id][:service_img], id: "overviewIcon#{overview_data[team.id][:service_id]}"}
      - is_first = false
    - @services.each do |team, service_list|
      - team = Team.new(name: 'None', id: 0) if team.nil?
      %li{id: "team#{team.id}Tab", class: (is_first ? 'active':'')}
        = hidden_field_tag 'team-id', team.id

        - unless current_user.is_red_team
          .progress.success.text{id: "uptime#{team.id}"}
            .meter{style:"width:#{team.uptime}%"}
              .text
                = "#{team.uptime}%"

        %table.twelve.services
          %thead
            %tr
              %th
              %th Name
              %th Worker
              %th Host
              %th Uptime
              - if current_user_admin?
                %th

          %tbody
            - service_list.each do |service|

              - unless service.blank?
                %tr{class: service_class(service), id:"service#{service.id}"}
                  %td.service_img{style:'padding:0px;'}
                  %td
                    = link_to service.name, service
                    - unless service.public
                      .label.secondary private
                  %td= service.worker
                  %td= service.params[service.worker]['rhost']+" : "+service.params[service.worker]['rport']
                  %td= "#{service.up_time}%"
                  - if current_user_admin?
                    %td
                      %ul.inline-list
                        %li= link_to '<i class="icon-pencil"> </i>Edit'.html_safe, edit_service_path(service)
                        %li= link_to_function '<i class="icon-bolt"> </i>Duplicate'.html_safe, "duplicate_service('#{service.id}','#{service.team_id}','#{service.name}')"
                        %li= link_to '<i class="icon-trash"> </i>Destroy'.html_safe, service, method: :delete, data: { confirm: 'Are you sure?' }
      - is_first = false

- if current_user_admin?
  - if @services.length > 0
    %br
  = link_to '<i class="icon-cloud"></i> Add Service'.html_safe, new_service_path, class: 'button'
  = link_to '<i class="icon-group"></i> Add Team'.html_safe, new_team_path, class: 'button'
  - if @services.length > 0
    = link_to_function '<i class="icon-pencil"></i> Edit Team'.html_safe, 'editTeamLink()', class: 'button'

  #duplicateModal.reveal-modal
    %a.close-reveal-modal &#215;
    %h2
      Duplicate
      %span#service_name
    = form_tag service_duplicate_path, method: :post, class: 'formee' do
      = hidden_field_tag 'service_id', ''
      .row
        .eight.columns.end
          = label_tag 'Team'
          = select_tag 'team_id', options_for_select(Team.options_list)
      .row
        = submit_tag 'Duplicate'

:javascript
  setInterval(updateService, 30*1000);

  function duplicate_service(service_id, team_id, service_name) {
    $('#duplicateModal #service_name').html("'"+service_name+"'");
    $('#duplicateModal #service_id').val(service_id);
    $('#duplicateModal #team_id').val(team_id);
    $("#duplicateModal").reveal();
  }

  function editTeamLink() {
    var team_id = $('#team-tabs .active #team-id').val();
    if(!team_id)
      alert('Not a valid team');
    else
      document.location = '/teams/' + team_id + "/edit"
  }