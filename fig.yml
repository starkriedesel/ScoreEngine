mysql:
  image: dockerfile/mariadb
  #ports:
  #  - "3306:3306"
  volumes:
    - .mysql:/var/lib/mysql
  command: "bash -c 'chown -R mysql:mysql /var/lib/mysql && mysqld'"

phpmyadmin:
  image: marvambass/phpmyadmin
  links:
    - mysql:mysql
  ports:
    - "443:443"

http:
  build: .
  links:
    - mysql:mysql
  ports:
    - "8080:8080"
  volumes:
    - ./config/:/app/config/
    - ./tmp/:/app/tmp/
  environment:
    RAILS_ENV: production
    VIRTUAL_HOST: score.gold.ssig
    VIRTUAL_PORT: 8080
  command: bash -l -c "rm -f /app/tmp/pids/server.pid && command rails server -p 8080"

engine:
  build: .
  links:
    - mysql:mysql
  volumes:
    - ./config/:/app/config/
    - ./tmp/:/app/tmp/
  environment:
    RAILS_ENV: production
  command: bash -l -c "rm -f /app/tmp/pids/ScoreEngine_Daemon.pid && command rake engine:start"

